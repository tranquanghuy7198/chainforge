import{r as m,R,j as e,N as k}from"./index-CDk-T4F3.js";import{I as O,T as z,B as S,G as P,u as T,J as V,L as $,F as i,e as g,S as q,N as H,c as J,E as W,M as X,H as G,g as K,d as E,D as _,A as Q}from"./index-IYRPo_Un.js";import{C as U}from"./index-MXDGtA3K.js";import{p as Y,A as Z,a as ee}from"./index-BQNfciMt.js";import{V as te,S as N,g as ae,h as se,v as re,u as oe,b as ne,c as ce,i as le,j as ie,k as de}from"./index-9dImWG2d.js";var me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"};function v(){return v=Object.assign?Object.assign.bind():function(t){for(var l=1;l<arguments.length;l++){var r=arguments[l];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},v.apply(this,arguments)}const ue=(t,l)=>m.createElement(O,v({},t,{ref:l,icon:me})),pe=m.forwardRef(ue),he=({checked:t,defaultChecked:l=!1,onChange:r})=>{const[c,u]=R.useState(l),n=t!==void 0,p=n?t:c;return e.jsx(z,{title:"Publish",placement:"left",children:e.jsx(S,{type:"text",shape:"circle",size:"small",icon:p?e.jsx(P,{className:"bookmark"}):e.jsx(pe,{}),onClick:()=>{const f=!p;n||u(f),r?.({target:{checked:f}})}})})},fe=(t,l)=>({template:Y({id:t.templateId,name:t.name,desscription:t.description,abi:t.abi,bytecode:t.bytecode,flattenSource:t.flattenSource,programKeypair:"[]",networkClusters:l.filter(r=>t.addresses.some(c=>c.blockchainId===r.id)).map(r=>r.networkCluster.toString())}),addresses:t.addresses}),xe=({contractForm:t,saveContract:l})=>{const{blockchains:r}=T(),[c]=V(),u=$("addresses",c),[n,p]=m.useState(!1);m.useEffect(()=>{t.open&&c.resetFields()},[c,t]);const f=async b=>{p(!0),await l({...b,templateId:t.form?.templateId??re(),bytecode:t.form?.bytecode??"{}"}),p(!1)};return e.jsxs(i,{form:c,name:"save-contract",layout:"horizontal",initialValues:t.form,autoComplete:"off",onFinish:f,children:[e.jsx(i.Item,{name:"name",label:"Name",required:!0,children:e.jsx(g,{placeholder:"Contract Name",disabled:n})}),e.jsx(i.Item,{name:"description",label:"Description",children:e.jsx(g.TextArea,{placeholder:"Description",disabled:n})}),e.jsx(i.Item,{name:"abi",label:"ABI",required:!0,children:e.jsx(te,{placeholder:"Contract ABI (EVM) or IDL (Solana)",disabled:n})}),e.jsx(i.Item,{name:"flattenSource",label:"Flatten Source",children:e.jsx(g.TextArea,{rows:4,placeholder:"Contract flatten source",disabled:n})}),e.jsx(i.Item,{label:"Addresses",tooltip:"By publishing this contract, you allow everyone to see and interact with it. To do so, you must be its owner or deployer",children:e.jsx(i.List,{name:"addresses",children:(b,{add:I,remove:y})=>e.jsxs("div",{className:"addresses",children:[b.map(d=>e.jsxs(q,{align:"baseline",children:[e.jsx(i.Item,{name:[d.name,"publicity"],valuePropName:"checked",children:e.jsx(he,{})}),e.jsx(i.Item,{name:[d.name,"blockchainId"],children:e.jsx(H,{disabled:n,className:"contract-chain-select",placeholder:"Blockchain",options:r.slice().sort((o,x)=>o.code.localeCompare(x.code)).map(o=>({label:o.name,value:o.id,emoji:o.logo})),optionRender:o=>e.jsx(N,{icon:o.data.emoji,label:o.data.label}),labelRender:({value:o,label:x})=>{const h=r.find(C=>C.id===o);return h?e.jsx(N,{icon:h.logo,label:x}):x}})}),e.jsx(i.Item,{name:[d.name,"address"],children:e.jsx(g,{placeholder:"Address",disabled:n})}),u&&(r.find(o=>o.id===u[d.name]?.blockchainId)?.networkCluster===k.Sui||r.find(o=>o.id===u[d.name]?.blockchainId)?.networkCluster===k.Aptos)&&e.jsx(i.Item,{name:[d.name,"module"],children:e.jsx(g,{placeholder:"Module"})}),e.jsx(S,{type:"text",size:"small",icon:e.jsx(ae,{}),disabled:n,onClick:()=>y(d.name)})]},d.key)),e.jsxs(S,{type:"dashed",onClick:()=>I(),block:!0,children:[e.jsx(se,{})," Add Address"]})]})})}),e.jsx(i.Item,{children:e.jsx(S,{type:"primary",htmlType:"submit",loading:n,children:"Save Contract"})})]})},Se=()=>{const[t,l]=J(),{blockchains:r}=T(),{fetchPopularContracts:c}=oe(),{fetchTemplates:u}=ne(),{contracts:n,fetchContracts:p}=ce(),{callAuthenticatedApi:f}=W(),[b,I]=m.useState([]),[y,d]=m.useState([]),[o,x]=m.useState(),[h,C]=m.useState({open:!1,form:void 0}),[w,A]=m.useState();m.useEffect(()=>{I(n.filter(s=>{if(o&&!s.template.name.toLowerCase().includes(o.toLowerCase()))return!1;for(const a of y)if(!r.filter(j=>s.addresses.map(B=>B.blockchainId).includes(j.id)).map(j=>j.networkCluster.toString()).includes(a))return!1;return!0}))},[n,r,y,o]);const D=s=>{try{return fe(s,r)}catch(a){throw t.error({message:"Invalid data",description:e.jsx(Q,{ellipsis:{rows:4,expandable:!0,symbol:"View Full"},children:a instanceof Error?a.message:String(a)})}),a}},F=async s=>{try{await f(n.some(a=>a.template.id===s.template.id)?le:ie,s),await p(!0),u(!0),c(!0),t.success({message:"Contract Saved",description:"A contract has been saved"})}catch(a){t.error({message:"Error saving contract",description:a instanceof Error?a.message:String(a)})}finally{C({open:!1})}},L=s=>{const a=n.find(j=>j.template.id===s);a?C({open:!0,form:{templateId:a.template.id,name:a.template.name,description:a.template.description,abi:JSON.stringify(a.template.abi),bytecode:a.template.bytecode,flattenSource:a.template.flattenSource,addresses:a.addresses}}):t.error({message:"Contract not found"})},M=async s=>{if(s)try{await f(de,s),await p(!0),u(!0),c(!0),t.success({message:"Contract Deleted",description:"A contract has been deleted"})}catch(a){t.error({message:"Error deleting contract",description:a instanceof Error?a.message:String(a)})}};return e.jsx(X,{children:e.jsxs("div",{className:"page",children:[l,e.jsx(Z,{}),e.jsx(G,{header:"Contract Explorer",options:Object.values(k).map(s=>({value:s.toString(),label:K(s.toString())})),onSelected:d,onSearched:x,onAddRequested:()=>C({open:!0,form:void 0}),defaultSelectAll:!1}),e.jsx("div",{className:"masonry-container",children:e.jsx(E.XMasonry,{center:!1,targetBlockWidth:300,children:b.map(s=>e.jsx(E.XBlock,{children:e.jsx(U,{contract:s,onDeleteContract:A,onEditContract:L})},s.template.id))})}),e.jsx(_,{width:800,title:h.form?h.form.name:"Add Contract",open:h.open,closable:!0,onClose:()=>C({...h,open:!1}),children:e.jsx(xe,{contractForm:h,saveContract:s=>F(D(s))})}),e.jsx(ee,{showModal:w!==void 0,danger:!0,onOk:()=>M(w),onCancel:()=>A(void 0),title:"Delete this contract?",description:"This action cannot be undone. All information associated with this contract will be lost.",okText:"Delete Contract"})]})})};export{Se as default};
//# sourceMappingURL=index-COWeXVzh.js.map

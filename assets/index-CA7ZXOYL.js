import{g as z,r as i,R as P,j as e,N as F}from"./index-DkmshHa7.js";import{I as V,T as q,B as y,E as $,u as T,G as H,J as _,F as l,e as g,S as J,L as W,c as X,A as G,M as K,H as Q,g as U,d as E,D as Y,z as Z}from"./index-CRgkOtPw.js";import{C as ee}from"./index-CmNx5Wew.js";import{p as te,A as ae,a as se}from"./index-DTzLiPWr.js";import{V as re,S as O,g as ne,h as oe,v as ce,u as le,b as ie,c as de,i as me,j as ue,k as pe}from"./index-8JwbiFrw.js";var v={},N;function he(){if(N)return v;N=1,Object.defineProperty(v,"__esModule",{value:!0});var t={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"};return v.default=t,v}var fe=he();const xe=z(fe);function I(){return I=Object.assign?Object.assign.bind():function(t){for(var c=1;c<arguments.length;c++){var r=arguments[c];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},I.apply(this,arguments)}const Ce=(t,c)=>i.createElement(V,I({},t,{ref:c,icon:xe})),je=i.forwardRef(Ce),be=({checked:t,defaultChecked:c=!1,onChange:r})=>{const[o,h]=P.useState(c),d=t!==void 0,u=d?t:o;return e.jsx(q,{title:"Publish",placement:"left",children:e.jsx(y,{type:"text",shape:"circle",size:"small",icon:u?e.jsx($,{className:"bookmark"}):e.jsx(je,{}),onClick:()=>{const f=!u;d||h(f),r?.({target:{checked:f}})}})})},ge=(t,c)=>({template:te({id:t.templateId,name:t.name,desscription:t.description,abi:t.abi,bytecode:"{}",flattenSource:t.flattenSource,programKeypair:"[]",networkClusters:c.filter(r=>t.addresses.some(o=>o.blockchainId===r.id)).map(r=>r.networkCluster.toString())}),addresses:t.addresses}),Se=({contractForm:t,saveContract:c})=>{const{blockchains:r}=T(),[o]=H(),h=_("addresses",o),[d,u]=i.useState(!1);i.useEffect(()=>{t.open&&o.resetFields()},[o,t]);const f=async j=>{u(!0),await c({...j,templateId:t.form?.templateId??ce()}),u(!1)};return e.jsxs(l,{form:o,name:"save-contract",layout:"horizontal",initialValues:t.form,autoComplete:"off",onFinish:f,children:[e.jsx(l.Item,{name:"name",label:"Name",required:!0,children:e.jsx(g,{placeholder:"Contract Name"})}),e.jsx(l.Item,{name:"description",label:"Description",children:e.jsx(g.TextArea,{placeholder:"Description"})}),e.jsx(l.Item,{name:"abi",label:"ABI",required:!0,children:e.jsx(re,{placeholder:"Contract ABI (EVM) or IDL (Solana)"})}),e.jsx(l.Item,{name:"flattenSource",label:"Flatten Source",children:e.jsx(g.TextArea,{rows:4,placeholder:"Contract flatten source"})}),e.jsx(l.Item,{label:"Addresses",tooltip:"By publishing this contract, you allow everyone to see and interact with it. To do so, you must be its owner or deployer",children:e.jsx(l.List,{name:"addresses",children:(j,{add:w,remove:S})=>e.jsxs("div",{className:"addresses",children:[j.map(m=>e.jsxs(J,{align:"baseline",children:[e.jsx(l.Item,{name:[m.name,"publicity"],valuePropName:"checked",children:e.jsx(be,{})}),e.jsx(l.Item,{name:[m.name,"blockchainId"],children:e.jsx(W,{className:"contract-chain-select",placeholder:"Blockchain",options:r.slice().sort((n,x)=>n.code.localeCompare(x.code)).map(n=>({label:n.name,value:n.id,emoji:n.logo})),optionRender:n=>e.jsx(O,{icon:n.data.emoji,label:n.data.label}),labelRender:({value:n,label:x})=>{const p=r.find(C=>C.id===n);return p?e.jsx(O,{icon:p.logo,label:x}):x}})}),e.jsx(l.Item,{name:[m.name,"address"],children:e.jsx(g,{placeholder:"Address"})}),h&&r.find(n=>n.id===h[m.name]?.blockchainId)?.networkCluster===F.Sui&&e.jsx(l.Item,{name:[m.name,"module"],children:e.jsx(g,{placeholder:"Module"})}),e.jsx(y,{type:"text",size:"small",icon:e.jsx(ne,{}),onClick:()=>S(m.name)})]},m.key)),e.jsxs(y,{type:"dashed",onClick:()=>w(),block:!0,children:[e.jsx(oe,{})," Add Address"]})]})})}),e.jsx(l.Item,{children:e.jsx(y,{type:"primary",htmlType:"submit",loading:d,children:"Save Contract"})})]})},Ae=()=>{const[t,c]=X(),{blockchains:r}=T(),{fetchPopularContracts:o}=le(),{fetchTemplates:h}=ie(),{contracts:d,fetchContracts:u}=de(),{callAuthenticatedApi:f}=G(),[j,w]=i.useState([]),[S,m]=i.useState([]),[n,x]=i.useState(),[p,C]=i.useState({open:!1,form:void 0}),[k,A]=i.useState();i.useEffect(()=>{w(d.filter(s=>{if(n&&!s.template.name.toLowerCase().includes(n.toLowerCase()))return!1;for(const a of S)if(!r.filter(b=>s.addresses.map(B=>B.blockchainId).includes(b.id)).map(b=>b.networkCluster.toString()).includes(a))return!1;return!0}))},[d,r,S,n]);const D=s=>{try{return ge(s,r)}catch(a){throw t.error({message:"Invalid data",description:e.jsx(Z,{ellipsis:{rows:4,expandable:!0,symbol:"View Full"},children:a instanceof Error?a.message:String(a)})}),a}},M=async s=>{try{await f(d.some(a=>a.template.id===s.template.id)?me:ue,s),await u(!0),await h(!0),await o(!0),t.success({message:"Contract Saved",description:"A contract has been saved"})}catch(a){t.error({message:"Error saving contract",description:a instanceof Error?a.message:String(a)})}finally{C({open:!1})}},L=s=>{const a=d.find(b=>b.template.id===s);a?C({open:!0,form:{templateId:a.template.id,name:a.template.name,description:a.template.description,abi:JSON.stringify(a.template.abi),flattenSource:a.template.flattenSource,addresses:a.addresses}}):t.error({message:"Contract not found"})},R=async s=>{if(s)try{await f(pe,s),await u(!0),await h(!0),await o(!0),t.success({message:"Contract Deleted",description:"A contract has been deleted"})}catch(a){t.error({message:"Error deleting contract",description:a instanceof Error?a.message:String(a)})}};return e.jsx(K,{children:e.jsxs("div",{className:"page",children:[c,e.jsx(ae,{}),e.jsx(Q,{header:"Contract Explorer",options:Object.values(F).map(s=>({value:s.toString(),label:U(s.toString())})),onSelected:m,onSearched:x,onAddRequested:()=>C({open:!0,form:void 0}),defaultSelectAll:!1}),e.jsx("div",{className:"masonry-container",children:e.jsx(E.XMasonry,{center:!1,targetBlockWidth:300,children:j.map(s=>e.jsx(E.XBlock,{children:e.jsx(ee,{contract:s,onDeleteContract:A,onEditContract:L})},s.template.id))})}),e.jsx(Y,{width:800,title:p.form?p.form.name:"Add Contract",open:p.open,closable:!0,onClose:()=>C({...p,open:!1}),children:e.jsx(Se,{contractForm:p,saveContract:s=>M(D(s))})}),e.jsx(se,{showModal:k!==void 0,danger:!0,onOk:()=>R(k),onCancel:()=>A(void 0),title:"Delete this contract?",description:"This action cannot be undone. All information associated with this contract will be lost.",okText:"Delete Contract"})]})})};export{Ae as default};
//# sourceMappingURL=index-CA7ZXOYL.js.map

import{r as d,R,j as e,N}from"./index-DY0zYy-t.js";import{I as O,T as z,B as S,G as P,u as T,J as V,L as $,F as i,e as g,S as q,N as H,c as J,E as W,M as X,H as G,g as K,d as A,D as _,A as Q}from"./index-DT0ZeBUN.js";import{C as U}from"./index-OXpxZGvT.js";import{p as Y,A as Z,a as ee}from"./index-CPMG2b4E.js";import{V as te,S as E,g as ae,h as se,v as re,u as oe,b as ne,c as ce,i as le,j as ie,k as de}from"./index-CKMSUMFg.js";var me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"};function v(){return v=Object.assign?Object.assign.bind():function(t){for(var l=1;l<arguments.length;l++){var r=arguments[l];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},v.apply(this,arguments)}const ue=(t,l)=>d.createElement(O,v({},t,{ref:l,icon:me})),pe=d.forwardRef(ue),he=({checked:t,defaultChecked:l=!1,onChange:r})=>{const[c,h]=R.useState(l),o=t!==void 0,u=o?t:c;return e.jsx(z,{title:"Publish",placement:"left",children:e.jsx(S,{type:"text",shape:"circle",size:"small",icon:u?e.jsx(P,{className:"bookmark"}):e.jsx(pe,{}),onClick:()=>{const f=!u;o||h(f),r?.({target:{checked:f}})}})})},fe=(t,l)=>({template:Y({id:t.templateId,name:t.name,desscription:t.description,abi:t.abi,bytecode:t.bytecode,flattenSource:t.flattenSource,programKeypair:"[]",networkClusters:l.filter(r=>t.addresses.some(c=>c.blockchainId===r.id)).map(r=>r.networkCluster.toString())}),addresses:t.addresses}),xe=({contractForm:t,saveContract:l})=>{const{blockchains:r}=T(),[c]=V(),h=$("addresses",c),[o,u]=d.useState(!1);d.useEffect(()=>{t.open&&c.resetFields()},[c,t]);const f=async b=>{u(!0),await l({...b,templateId:t.form?.templateId??re(),bytecode:t.form?.bytecode??"{}"}),u(!1)};return e.jsxs(i,{form:c,name:"save-contract",layout:"horizontal",initialValues:t.form,autoComplete:"off",onFinish:f,children:[e.jsx(i.Item,{name:"name",label:"Name",required:!0,children:e.jsx(g,{placeholder:"Contract Name",disabled:o})}),e.jsx(i.Item,{name:"description",label:"Description",children:e.jsx(g.TextArea,{placeholder:"Description",disabled:o})}),e.jsx(i.Item,{name:"abi",label:"ABI",required:!0,children:e.jsx(te,{placeholder:"Contract ABI (EVM) or IDL (Solana)",disabled:o})}),e.jsx(i.Item,{name:"flattenSource",label:"Flatten Source",children:e.jsx(g.TextArea,{rows:4,placeholder:"Contract flatten source",disabled:o})}),e.jsx(i.Item,{label:"Addresses",tooltip:"By publishing this contract, you allow everyone to see and interact with it. To do so, you must be its owner or deployer",children:e.jsx(i.List,{name:"addresses",children:(b,{add:w,remove:y})=>e.jsxs("div",{className:"addresses",children:[b.map(m=>e.jsxs(q,{align:"baseline",children:[e.jsx(i.Item,{name:[m.name,"publicity"],valuePropName:"checked",children:e.jsx(he,{})}),e.jsx(i.Item,{name:[m.name,"blockchainId"],children:e.jsx(H,{disabled:o,className:"contract-chain-select",placeholder:"Blockchain",options:r.slice().sort((n,x)=>n.code.localeCompare(x.code)).map(n=>({label:n.name,value:n.id,emoji:n.logo})),optionRender:n=>e.jsx(E,{icon:n.data.emoji,label:n.data.label}),labelRender:({value:n,label:x})=>{const p=r.find(C=>C.id===n);return p?e.jsx(E,{icon:p.logo,label:x}):x}})}),e.jsx(i.Item,{name:[m.name,"address"],children:e.jsx(g,{placeholder:"Address",disabled:o})}),h&&r.find(n=>n.id===h[m.name]?.blockchainId)?.networkCluster===N.Sui&&e.jsx(i.Item,{name:[m.name,"module"],children:e.jsx(g,{placeholder:"Module"})}),e.jsx(S,{type:"text",size:"small",icon:e.jsx(ae,{}),disabled:o,onClick:()=>y(m.name)})]},m.key)),e.jsxs(S,{type:"dashed",onClick:()=>w(),block:!0,children:[e.jsx(se,{})," Add Address"]})]})})}),e.jsx(i.Item,{children:e.jsx(S,{type:"primary",htmlType:"submit",loading:o,children:"Save Contract"})})]})},Se=()=>{const[t,l]=J(),{blockchains:r}=T(),{fetchPopularContracts:c}=oe(),{fetchTemplates:h}=ne(),{contracts:o,fetchContracts:u}=ce(),{callAuthenticatedApi:f}=W(),[b,w]=d.useState([]),[y,m]=d.useState([]),[n,x]=d.useState(),[p,C]=d.useState({open:!1,form:void 0}),[I,k]=d.useState();d.useEffect(()=>{w(o.filter(s=>{if(n&&!s.template.name.toLowerCase().includes(n.toLowerCase()))return!1;for(const a of y)if(!r.filter(j=>s.addresses.map(B=>B.blockchainId).includes(j.id)).map(j=>j.networkCluster.toString()).includes(a))return!1;return!0}))},[o,r,y,n]);const D=s=>{try{return fe(s,r)}catch(a){throw t.error({message:"Invalid data",description:e.jsx(Q,{ellipsis:{rows:4,expandable:!0,symbol:"View Full"},children:a instanceof Error?a.message:String(a)})}),a}},F=async s=>{try{await f(o.some(a=>a.template.id===s.template.id)?le:ie,s),await u(!0),await h(!0),await c(!0),t.success({message:"Contract Saved",description:"A contract has been saved"})}catch(a){t.error({message:"Error saving contract",description:a instanceof Error?a.message:String(a)})}finally{C({open:!1})}},L=s=>{const a=o.find(j=>j.template.id===s);a?C({open:!0,form:{templateId:a.template.id,name:a.template.name,description:a.template.description,abi:JSON.stringify(a.template.abi),bytecode:a.template.bytecode,flattenSource:a.template.flattenSource,addresses:a.addresses}}):t.error({message:"Contract not found"})},M=async s=>{if(s)try{await f(de,s),await u(!0),await h(!0),await c(!0),t.success({message:"Contract Deleted",description:"A contract has been deleted"})}catch(a){t.error({message:"Error deleting contract",description:a instanceof Error?a.message:String(a)})}};return e.jsx(X,{children:e.jsxs("div",{className:"page",children:[l,e.jsx(Z,{}),e.jsx(G,{header:"Contract Explorer",options:Object.values(N).map(s=>({value:s.toString(),label:K(s.toString())})),onSelected:m,onSearched:x,onAddRequested:()=>C({open:!0,form:void 0}),defaultSelectAll:!1}),e.jsx("div",{className:"masonry-container",children:e.jsx(A.XMasonry,{center:!1,targetBlockWidth:300,children:b.map(s=>e.jsx(A.XBlock,{children:e.jsx(U,{contract:s,onDeleteContract:k,onEditContract:L})},s.template.id))})}),e.jsx(_,{width:800,title:p.form?p.form.name:"Add Contract",open:p.open,closable:!0,onClose:()=>C({...p,open:!1}),children:e.jsx(xe,{contractForm:p,saveContract:s=>F(D(s))})}),e.jsx(ee,{showModal:I!==void 0,danger:!0,onOk:()=>M(I),onCancel:()=>k(void 0),title:"Delete this contract?",description:"This action cannot be undone. All information associated with this contract will be lost.",okText:"Delete Contract"})]})})};export{Se as default};
//# sourceMappingURL=index-sToFBA4i.js.map
